{% extends 'layout.html' %}
{% block body %}
<h2>Your Shipments</h2>

<div id="map-canvas"></div>
    
<script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAXorWmQbNW4J7fGwSSpoZjjd9IgNvOGSQ">
</script>
<script type="text/javascript">
  var geocoder;
  var map;


  function initialize() {
  	geocoder = new google.maps.Geocoder();
  	var latlng = new google.maps.LatLng(37.7833, -122.4167);
    var mapOptions = {
      center: latlng,
      zoom: 8
    };
    map = new google.maps.Map(document.getElementById("map-canvas"),
        					  mapOptions);
  }


  function getLatLong() {
  	var location = { {{ location_id }}: "{{location}}" }
  	for (loc_id in location) {
  		console.log("loc_id is: ", + loc_id);
  		console.log("location[loc_id] is: " + location[loc_id]);
	    geocoder.geocode({ 'address': location[loc_id]}, function(results, status) {
	    	if (status == google.maps.GeocoderStatus.OK) {
				var result = results[0].geometry.location;
				console.log("result is: " + result);
				makeSaveLocRequest(loc_id, result);
			} else {
				alert("Geocode was not successful for the following reason: " + status);
			}
		});
  	}
  }

  function makeSaveLocRequest(loc_id, latlong) {
  	$.ajax({
  		url : "http://localhost:5050/save_location",
  		type: "POST",
  		data: {
  			id: loc_id,
  			latlong: latlong.toString()
  		}
  	}).fail(function(resp){
  		console.log("makeSaveLocRequest failed.");
  	}).done(function(resp){
  		console.log(" makeSaveLocRequest succeeded.");
  	});
  }



  google.maps.event.addDomListener(window, 'load', initialize);
</script>
{% endblock %}